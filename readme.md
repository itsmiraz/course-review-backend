This a express app with varius features based on the requirements
This Besically for course review app.

## Getting Started

To get you started you can simply clone the repository:

```
git clone https://github.com/Porgramming-Hero-web-course/l2b2a4-course-review-with-auth-itsmiraz.git
```

and install the dependencies

```
npm install
```

### Prerequisites

You need git to clone the repository. You can get git from
[http://git-scm.com/](http://git-scm.com/).

A number of node.js tools is necessary to initialize and test the project. You must have node.js and its package manager (npm) installed. You can get them from [http://nodejs.org/](http://nodejs.org/). The tools/modules used in this project are listed in package.json and include express, mongodb and mongoose.

## API Routes

### 1. GET /api/courses

- **Description:** Get a list of all courses.

### 2. POST /api/course

- **Description:** Create Course.
- **Request Body:**
  ```json
  {
    "title": "Sample Course",
    "instructor": "Jane Doe",
    "categoryId": "123456789012345678901234",
    "price": 49.99,
    "tags": [
      {
        "name": "Programming",
        "isDeleted": false
      },
      {
        "name": "Web Development",
        "isDeleted": false
      }
    ],
    "startDate": "2023-01-15",
    "endDate": "2023-03-14",
    "language": "English",
    "provider": "Tech Academy",
    "details": {
      "level": "Intermediate",
      "description": "Detailed description of the course"
    }
  }
  ```

### 3. PUT api/courses/:courseId

- **Description:** Update Course.

### 4. GET /api/courses/:courseId/reviews

- **Description:** Get Reviews for Course.

### 5. POST /api/categories

- **Description:** Create Catagory.
- **Request Body:**
  ```json
  {
    "name": "Programming"
  }
  ```

### 6. GET /api/categories

- **Description:** Get Categories.

### 7. GET /api/categories

- **Description:** Get Categories.

### 8. POST /api/reviews

- **Description:** Get Categories.
- **Request Body:**
  ```json
  {
    "courseId": "123456789012345678901234",
    "rating": 4,
    "review": "Great course!"
  }
  ```

## 1. User Model:

1. **\_id (Object ID):** A distinctive identifier generated by MongoDB.
2. **username (string):** The username of the user. This field holds a unique identifier for the user.
3. **email (string):** The email address of the user. This field stores the user's email, ensuring it is unique.
4. **password (string):** The password linked to the user's account, securely hashed. Strong password validation is encouraged, with specified format requirements. If implementing password strength validation, please provide the password format and appropriate error message for user guidance.
5. **role ('user' | 'admin'):** The role of the user, which can be either 'user' or 'admin'. This field determines the user's level of access or permissions. The default role is set to 'user'.

## 2. **Course Model:**

- **\_id (Object ID):** A distinctive identifier generated by MongoDB.
- **title (String):** A **unique** title of the course.
- **instructor (String):** The instructor of the course.
- **categoryId (Object ID):** A reference to the category collection.
- **price (Number):** The price of the course.
- **tags(Array of Object):** The "tags" field is an array of objects, each having a "name" (string) and "isDeleted" (boolean) property.
- **startDate (String):** The start date of the course.
- **endDate (String):** The end date of the course.
- **language (String):** The language in which the course is conducted.
- **provider (String):** The provider of the course.
- **durationInWeeks (Integer):** This represents the course's overall duration in weeks, **calculated by applying the ceil function to the numeric value derived from the start and end dates**. The resulting number is rounded up to the nearest integer, ensuring that the duration is expressed solely as an integer with no allowance for floating-point numbers.
- **details (Object):**
  - **level (string):** e.g., Beginner, Intermediate, Advanced.
  - **description (string):** Detailed description of the course
- **createdBy (Object ID):** A reference to the user collection.

## 3. **Category Model:**

- **\_id (Object ID):** A distinctive identifier generated by MongoDB.
- **name (String):** A unique name of the category.
- **createdBy (Object ID):** A reference to the user collection.

## 4. **Review Model:**

- **\_id (Object ID):** A distinctive identifier generated by MongoDB.
- **courseId (Object ID):** A reference to the course collection.
- **rating (Number):** Rating, which falls within the range of 1 to 5.
- **review (String):** The comment or review text provided by the user.
- **createdBy (Object ID):** A reference to the user collection.

### 1. User Registration

- **Route:** `/api/auth/register`
- **Method:** POST
- **Request Body:**
  ```json
  {
    "username": "john_doe",
    "email": "john@example.com",
    "password": "123456",
    "role": "user"
  }
  ```
- **Response:**
  - Make sure that the password field or any other security-related field is not included in the response data.
  ```json
  {
    "success": true,
    "statusCode": 201,
    "message": "User registered successfully",
    "data": {
      "_id": "54321abcde67890fghij",
      "username": "john_doe",
      "email": "john@example.com",
      "role": "user",
      "createdAt": "2023-01-01T12:00:00.000Z",
      "updatedAt": "2023-01-01T12:00:00.000Z"
    }
  }
  ```

### 2. User Login

- **Route:** `/api/auth/login`
- **Method:** POST
- **Request Body:**
  ```json
  {
    "username": "john_doe",
    "password": "123456"
  }
  ```
- **Response:**
  - Make sure that the password field or any other security-related field is not included in the response data.
  ```json
  {
    "success": true,
    "statusCode": 200,
    "message": "User login successful",
    "data": {
      "user": {
        "_id": "54321abcde67890fghij",
        "username": "john_doe",
        "email": "john@example.com",
        "role": "user"
      },
      "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"
    }
  }
  ```

In this example:

- The request body includes the user's credentials, such as `username` and `password`.
- The response includes a success indicator, status code, message, and data containing user details (such as `_id`, `username`, `email`, `role`) & JWT token.

**JWT Token Payload:**

```json
{
  "_id": "54321abcde67890fghij", // User's _id
  "role": "user", // User's role
  "email": "john@example.com", // User's email
  "iat": 1626619535, // Issued At (timestamp)
  "exp": 1626623535 // Expiration (timestamp)
}
```

### **3. Change Password**

- **Route:** **`/api/auth/change-password`**
- **Method:** POST
- **Request Headers:**

```markdown
Authorization: <JWT_TOKEN>
```

- **Request Body:**

```json
{
  "currentPassword": "123456",
  "newPassword": "new123456"
}
```

- **`currentPassword`**: The user's current password for verification.
- **`newPassword`**: The new password the user wants to set.

- **Response:**
  - Make sure that the password field or any other security-related field is not included in the response data.

```json
{
  "success": true,
  "statusCode": 200,
  "message": "Password changed successfully",
  "data": {
    "_id": "54321abcde67890fghij",
    "username": "john_doe",
    "email": "john@example.com",
    "role": "user",
    "createdAt": "2023-01-01T12:00:00.000Z",
    "updatedAt": "2023-01-02T12:30:00.000Z"
  }
}
```

- The response includes a success indicator, status code, message, and updated user details.

### **Password Change Rules:**

- The system stores only the last 2 previous passwords with timestamps.
- During a password change attempt:
  - The user cannot reuse any of the last 2 passwords or the current one.
  - If the new password matches any of the previous 2 passwords or the current one, the password change fails.
  - If the new password is unique and different from the current password, the password change is successful.

[**Hints:** You can maintain a password change history by storing the changes along with timestamps. This information can be stored in a dedicated collection or optionally embedded within the user collection. The key is to ensure that your logic needs to fulfill our requirements]

**Response (if password change failed):**

```json
{
  "success": false,
  "statusCode": 400,
  "message": "Password change failed. Ensure the new password is unique and not among the last 2 used (last used on 2023-01-01 at 12:00 PM).",
  "data": null
}
```

### 4**. Create a Course (Only Admin can do this)**

- **Endpoint:** **`/api/courses`**
- **Method:** **POST**
- **Request Headers:**
  ```markdown
  Authorization: <ADMIN_JWT_TOKEN>
  ```
- **Request Body:**
  ```json
  {
    "title": "Introduction to Web Development",
    "instructor": "John Smith",
    "categoryId": "12345abcde67890fghij",
    "price": 49.99,
    "tags": [
      { "name": "Programming", "isDeleted": false },
      { "name": "Web Development", "isDeleted": false }
    ],
    "startDate": "2023-02-01",
    "endDate": "2023-04-01",
    "language": "English",
    "provider": "Tech Academy",
    "durationInWeeks": 8,
    "details": {
      "level": "Beginner",
      "description": "A comprehensive introduction to web development."
    }
  }
  ```
- **Response:**
  ```json
  {
    "success": true,
    "statusCode": 201,
    "message": "Course created successfully",
    "data": {
      "_id": "67890fghij54321abcde",
      "title": "Introduction to Web Development",
      "instructor": "John Smith",
      "categoryId": "12345abcde67890fghij",
      "price": 49.99,
      "tags": [
        { "name": "Programming", "isDeleted": false },
        { "name": "Web Development", "isDeleted": false }
      ],
      "startDate": "2023-02-01",
      "endDate": "2023-04-01",
      "language": "English",
      "provider": "Tech Academy",
      "durationInWeeks": 8,
      "details": {
        "level": "Beginner",
        "description": "A comprehensive introduction to web development."
      },
      "createdBy": "adminUserId", // Include an addition during assignment 4
      "createdAt": "2023-01-15T12:00:00.000Z",
      "updatedAt": "2023-01-15T12:00:00.000Z"
    }
  }
  ```

### 5. Get Paginated and Filtered Courses.

- **Endpoint:** **`/api/courses`**
- **Method:** **GET**

### Query Parameters for API Requests:

When interacting with the API, you can utilize the following query parameters to customize and filter the results according to your preferences.

- page: (Optional) Specifies the page number for paginated results. Default is 1.
  Example: ?page=2
- limit: (Optional) Sets the number of items per page. Default is a predefined limit.
  Example: ?limit=10
- sortBy: (Optional) Specifies the field by which the results should be sorted. Only applicable to the following fields: `title`, `price`, `startDate`, `endDate`, `language`, `durationInWeeks`.
  Example: ?sortBy=startDate
- sortOrder: (Optional) Determines the sorting order, either 'asc' (ascending) or 'desc' (descending).
  Example: ?sortOrder=desc
- minPrice, maxPrice: (Optional) Filters results by a price range.
  Example: ?minPrice=20.00&maxPrice=50.00
- tags: (Optional) Filters results by the name of a specific tag.
  Example: ?tags=Programming
- startDate, endDate: (Optional) Filters results by a date range.
  Example: ?startDate=2023-01-01&endDate=2023-12-31
- language: (Optional) Filters results by the language of the course.
  Example: ?language=English
- provider: (Optional) Filters results by the course provider.
  Example: ?provider=Tech Academy
- durationInWeeks: (Optional) Filters results by the duration of the course in weeks.
  Example: ?durationInWeeks=8
- level: (Optional) Filters results by the difficulty level of the course.
  Example: ?level=Intermediate
- **Response:**
  - Make sure that the password field or any other security-related field is not included in the response data.
  ```json
  {
    "success": true,
    "statusCode": 200,
    "message": "Courses retrieved successfully",
    "meta": {
      "page": 1,
      "limit": 10,
      "total": 50
    },
    "data": {
      "courses": [
        {
          "_id": "67890fghij54321abcde",
          "title": "Introduction to Web Development",
          "instructor": "John Smith",
          "categoryId": "12345abcde67890fghij",
          "price": 49.99,
          "tags": [
            { "name": "Programming", "isDeleted": false },
            { "name": "Web Development", "isDeleted": false }
          ],
          "startDate": "2023-02-01",
          "endDate": "2023-04-01",
          "language": "English",
          "provider": "Tech Academy",
          "durationInWeeks": 8,
          "details": {
            "level": "Beginner",
            "description": "A comprehensive introduction to web development."
          },
          "createdBy": {
            // Include an addition during assignment 4
            "_id": "adminUserId",
            "username": "adminUser",
            "email": "admin@example.com",
            "role": "admin"
          },
          "createdAt": "2023-01-15T12:00:00.000Z",
          "updatedAt": "2023-01-15T12:00:00.000Z"
        }
        // ... other courses
      ]
    }
  }
  ```

### 6**. Create a Category (Only Admin can do this)**

- **Endpoint:** **`/api/categories`**
- **Method:** **POST**
- **Request Headers:**
  ```markdown
  Authorization: <ADMIN_JWT_TOKEN>
  ```
- **Request Body:**
  ```json
  {
    "name": "Web Development"
  }
  ```
- **Response:**
  ```json
  {
    "success": true,
    "statusCode": 201,
    "message": "Category created successfully",
    "data": {
      "_id": "12345abcde67890fghij",
      "name": "Web Development",
      "createdBy": "adminUserId",
      "createdAt": "2023-01-15T12:00:00.000Z",
      "updatedAt": "2023-01-15T12:00:00.000Z"
    }
  }
  ```
  ### 7**. Get All Categories**
  - **Endpoint:** **`/api/categories`**
  - **Method:** **GET**
  - **Response:**
    - Make sure that the password field or any other security-related field is not included in the response data.
    ```json
    {
      "success": true,
      "statusCode": 200,
      "message": "Categories retrieved successfully",
      "data": {
        "categories": [
          {
            "_id": "12345abcde67890fghij",
            "name": "Web Development",
            "createdBy": {
              // Include an addition during assignment 4
              "_id": "adminUserId",
              "username": "adminUser",
              "email": "admin@example.com",
              "role": "admin"
            },
            "createdAt": "2023-01-15T12:00:00.000Z",
            "updatedAt": "2023-01-15T12:00:00.000Z"
          }
          // ... other categories
        ]
      }
    }
    ```
  ### 8**. Create a Review (Only the user can do this)**
  - **Endpoint:** **`/api/reviews`**
  - **Method:** **POST**
  - **Request Headers:**
    ```markdown
    Authorization: <USER_JWT_TOKEN>
    ```
  - **Request Body:**
    ```json
    {
      "courseId": "67890fghij54321abcde",
      "rating": 4,
      "review": "Great course, very informative and well-structured."
    }
    ```
  - **Response:**
    - Make sure that the password field or any other security-related field is not included in the response data.
    ```json
    {
      "success": true,
      "statusCode": 201,
      "message": "Review created successfully",
      "data": {
        "_id": "98765fghij43210lkji",
        "courseId": "67890fghij54321abcde",
        "rating": 4,
        "review": "Great course, very informative and well-structured.",
        "createdBy": {
          // Include an addition during assignment 4
          "_id": "UserId",
          "username": "username",
          "email": "user@example.com",
          "role": "user"
        },
        "createdAt": "2023-01-15T12:00:00.000Z",
        "updatedAt": "2023-01-15T12:00:00.000Z"
      }
    }
    ```
  ### 9**. Update a Course (Only Admin can do this)**
  - **Endpoint:** **`/api/courses/:courseId`**
  - **Method:** **PUT**
  - **Request Headers:**
    ```markdown
    Authorization: <ADMIN_JWT_TOKEN>
    ```
  - **Request Body:**
    ```json
    {
      "price": 59.99,
      "tags": [
        { "name": "Programming", "isDeleted": false },
        { "name": "Web Development", "isDeleted": false },
        { "name": "JavaScript", "isDeleted": false }
      ],
      "details": {
        "level": "Intermediate",
        "description": "A comprehensive course on web development with a focus on JavaScript."
      }
    }
    ```
  - **Response:**
    - Make sure that the password field or any other security-related field is not included in the response data.
    ```json
    {
      "success": true,
      "statusCode": 200,
      "message": "Course updated successfully",
      "data": {
        "_id": "67890fghij54321abcde",
        "title": "Introduction to Web Development",
        "instructor": "John Smith",
        "categoryId": "12345abcde67890fghij",
        "price": 59.99,
        "tags": [
          { "name": "Programming", "isDeleted": false },
          { "name": "Web Development", "isDeleted": false },
          { "name": "JavaScript", "isDeleted": false }
        ],
        "startDate": "2023-02-01",
        "endDate": "2023-04-01",
        "language": "English",
        "provider": "Tech Academy",
        "durationInWeeks": 8,
        "details": {
          "level": "Intermediate",
          "description": "A comprehensive course on web development with a focus on JavaScript."
        },
        "createdBy": {
          // Include an addition during assignment 4
          "_id": "adminUserId",
          "username": "adminUser",
          "email": "admin@example.com",
          "role": "admin"
        },
        "createdAt": "2023-01-15T12:00:00.000Z",
        "updatedAt": "2023-01-16T12:30:00.000Z"
      }
    }
    ```
  ### 10**. Get Course by ID with Reviews**
  - **Endpoint:** **`/api/courses/:courseId/reviews`**
  - **Method:** **GET**
  - **Response:**
    ```json
    {
      "success": true,
      "statusCode": 200,
      "message": "Course with reviews retrieved successfully",
      "data": {
        "course": {
          "_id": "67890fghij54321abcde",
          "title": "Introduction to Web Development",
          "instructor": "John Smith",
          "categoryId": "12345abcde67890fghij",
          "price": 59.99,
          "tags": [
            { "name": "Programming", "isDeleted": false },
            { "name": "Web Development", "isDeleted": false },
            { "name": "JavaScript", "isDeleted": false }
          ],
          "startDate": "2023-02-01",
          "endDate": "2023-04-01",
          "language": "English",
          "provider": "Tech Academy",
          "durationInWeeks": 8,
          "details": {
            "level": "Intermediate",
            "description": "A comprehensive course on web development with a focus on JavaScript."
          },
          "createdBy": {
            // Include an addition during assignment 4
            "_id": "adminUserId",
            "username": "adminUser",
            "email": "admin@example.com",
            "role": "admin"
          },
          "createdAt": "2023-01-15T12:00:00.000Z",
          "updatedAt": "2023-01-16T12:30:00.000Z"
        },
        "reviews": [
          {
            "_id": "98765fghij43210lkji",
            "courseId": "67890fghij54321abcde",
            "rating": 4,
            "review": "Great course, very informative and well-structured.",
            "createdBy": {
              // Include an addition during assignment 4
              "_id": "userid",
              "username": "username",
              "email": "user@example.com",
              "role": "user"
            },
            "createdAt": "2023-01-15T12:00:00.000Z",
            "updatedAt": "2023-01-15T12:00:00.000Z"
          }
          // ... other reviews
        ]
      }
    }
    ```
  ### 11**. Get the Best Course Based on Average Review (Rating)**
  - **Endpoint:** **`/api/course/best`**
  - **Method:** **GET**
  - **Response:**
    ```json
    {
      "success": true,
      "statusCode": 200,
      "message": "Best course retrieved successfully",
      "data": {
        "course": {
          "_id": "23245dsfd453242348rFcg",
          "title": "Best Book Title",
          "instructor": "New Instructor",
          "categoryId": "123456789012345678901234",
          "price": 59.99,
          "tags": [
            {
              "name": "Programming",
              "isDeleted": false
            },
            {
              "name": "Web Development",
              "isDeleted": false
            }
          ],
          "startDate": "2023-02-01",
          "endDate": "2023-03-14",
          "language": "Spanish",
          "provider": "Code Masters",
          "durationInWeeks": 6,
          "details": {
            "level": "Intermediate",
            "description": "Detailed description of the course"
          },
          "createdBy": {
            "_id": "userid",
            "username": "username",
            "email": "user@example.com",
            "role": "user"
          },
          "createdAt": "2023-01-15T12:00:00.000Z",
          "updatedAt": "2023-01-15T12:00:00.000Z"
        },
        "averageRating": 4.8,
        "reviewCount": 50
      }
    }
    ```

## Run the Application

The project is preconfigured with a simple development web server. The simplest way to start this server is:

```
npm run build
```

```
npm run start:prod
```

## For Testing with Postman

#### Base URL

```
https://course-review-backend-two.vercel.app/api
```
